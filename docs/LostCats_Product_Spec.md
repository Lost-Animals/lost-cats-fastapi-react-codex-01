# Платформа „LostCats“ — Пълно продуктово описание (независимо от технология)

## 1) Цел и обхват
Платформата „LostCats“ помага на хората да:
- публикуват **обяви за изгубена котка**;
- публикуват **обяви за намерена котка**;
- **проверяват по микрочип** дали котка е обявена като изгубена/намерена;
- намират потенциални съвпадения по **местоположение, време и описателни атрибути**;
- осъществяват контакт между намерилия и собственика **по безопасен и поверителен начин**.

Системата е публично достъпна за разглеждане, но публикуването/контактът изисква регистрация.

---

## 2) Роли и права
### 2.1 Роли
- **Гост (unauthenticated)**: разглежда обяви, търси/филтрира, проверява микрочип (публичен резултат), вижда контакт „чрез платформата“ (без да вижда лични данни).
- **Регистриран потребител**:
  - създава/редактира/архивира свои обяви;
  - качва снимки (до **5** на обява);
  - отговаря на съобщения за негови обяви;
  - подава сигнал (report) за злоупотреба.
- **Модератор/Администратор**:
  - преглежда репорти, скрива/изтрива обяви при нарушение;
  - управлява категории, настройка на радиуси, лимити, забранени думи;
  - разглежда логове (audit), банва акаунти.

### 2.2 Глобални правила
- Една обява е **само за 1 котка**.
- Снимки: **1–5** (минимум 1 препоръчително; допустимо е 0 само ако потребителят няма снимка).
- Местоположение: задължително е **приблизително** местоположение (точка + точност/радиус), за да се пази личната сигурност.
- Микрочип: ако е наличен — може да се въведе; системата трябва да поддържа и „неизвестен/няма“.

---

## 3) Ключови потребителски потоци (User journeys)
### 3.1 Регистрация и вход
- Регистрация с имейл + парола (минимум правила за сложност).
- Потвърждение на имейл (препоръчително).
- Вход/изход.
- Забравена парола / reset.

### 3.2 Публикуване на „Изгубена котка“
Потребителят попълва:
- основни данни за котката (име, пол/възраст приблизително, цвят и т.н.);
- дата/час на загуба (или приблизително);
- местоположение на загуба (map pin + район/град);
- описание (свободен текст);
- микрочип (по желание);
- паспорт номер (по желание);
- снимки (до 5).

След публикуване:
- обявата става „Активна“;
- системата предлага „възможни съвпадения“ сред намерени котки в близост и близка дата;
- потребителят може да сподели линк към обявата.

### 3.3 Публикуване на „Намерена котка“
Подобно на 3.2, но:
- дата/час на намиране;
- местоположение на намиране;
- допълнително поле: „временно приютена ли е котката?“ (да/не/не е сигурно) и „има ли нужда от ветеринар“ (опционално).

### 3.4 Проверка по микрочип
Потребителят въвежда микрочип номер:
- получава резултат дали има **активни** обяви, свързани с този микрочип (изгубена/намерена);
- показва се минимална информация + бутон „Свържи се чрез платформата“ (ако потребителят е логнат).
- системата не разкрива лични контакти директно, освен ако собственикът изрично не ги е публикувал (по подразбиране — не).

### 3.5 Контакт и съобщения
- Вътрешна система за съобщения/чат към конкретна обява (thread).
- Собственикът/публикуващият получава нотификация (in-app, и/или email).
- Анти-спам лимити: напр. max N съобщения/час към различни обяви.

### 3.6 Архивиране/Затваряне на обява
- Статуси: `ACTIVE`, `RESOLVED`, `ARCHIVED`, `HIDDEN_BY_MODERATION`.
- При „RESOLVED“ се пита: „намерена ли е котката?“/„предадена ли е?“ и се записва дата на разрешаване.
- Обяви по подразбиране се архивират след X дни неактивност (напр. 180), но потребителят може да удължи.

---

## 4) Функционални изисквания (FR)
### FR-1 Обяви
- Създаване, редакция, преглед, търсене, филтриране, споделяне.
- Два типа обяви: `LOST` и `FOUND`.
- Валидации:
  - max 5 снимки;
  - валидни координати;
  - микрочип: само цифри (обичайно 15), но да се позволява вариация (различни държави/формати) — да се конфигурира.
  - описание: лимит (например 2000 символа).

### FR-2 Търсене и филтри
- Филтри по:
  - тип (`LOST/FOUND`);
  - радиус от локация;
  - дата диапазон;
  - град/район (текстово);
  - цвят/дължина на козина;
  - наличие на микрочип.
- Сортиране: по най-нови, най-близки, най-актуализирани.

### FR-3 Съвпадения (Matching)
- Система за „suggested matches“ между `LOST` и `FOUND`.
- Базов алгоритъм:
  - гео разстояние (Haversine) + времева близост + сходство по атрибути (цвят, шарка, възраст, размер).
- Резултатът е списък със скор (0–1) и обяснение (напр. „2.1 км, 3 дни разлика, подобен цвят“).

### FR-4 Микрочип проверка
- Въвеждане на номер и проверка за активни обяви.
- Ако има повече от една обява с този чип (възможно при грешка/дубликат), показва се списък.

### FR-5 Снимки
- Качване/изтриване/подреждане на снимки.
- Автоматична оптимизация: генериране на thumbnail.
- EXIF премахване (за защита на лични данни).

### FR-6 Местоположение
- Въвеждане на точка на карта + текстово поле за адрес/район (не е нужно да е точен адрес).
- Поле за точност/радиус (напр. 100м, 500м, 1км) — по подразбиране 500м.

### FR-7 Потребители
- Профил: име (псевдоним), аватар, предпочитан канал за контакт (само чрез платформата/по избор да показва телефон).
- Настройки за нотификации: email/in-app.

### FR-8 Сигурност и модерация
- Report/flag на обява и на съобщение.
- Rate limiting за:
  - логин;
  - публикации;
  - съобщения.
- Автоматични проверки за забранени думи/телефон в описание (по политика).

---

## 5) Нефункционални изисквания (NFR)
### 5.1 Производителност
- Време за зареждане на листинг: цел < 1.5s за първа страница (при нормално натоварване).
- Търсене по локация: < 800ms (цел).

### 5.2 Надеждност
- 99.5% месечна наличност (цел).
- Идемпотентност при качване на снимки и създаване на обява (за да няма дубли при retry).

### 5.3 Сигурност
- Пароли хеширани със съвременен алгоритъм (напр. Argon2/bcrypt).
- Защитен достъп до файловете (подписани URL или proxy).
- Защита от XSS/CSRF (според клиент/сървър модел).
- Логове и audit trail за модераторски действия.

### 5.4 Поверителност
- По подразбиране не се показва точен адрес, само приблизителна локация.
- Опция: „скрий точката на картата, показвай само град/квартал“.
- GDPR-ready:
  - Export на данни (по заявка);
  - Delete account (soft delete + ретенция).

### 5.5 Достъпност и UX
- Мобилно-приятелски интерфейс.
- WCAG базови практики: контраст, клавиатурна навигация.
- Поддръжка на български език (и възможност за EN в бъдеще).

---

## 6) Данни и структури (Data model — концептуално)
> По-долу са **логически** структури. Технологичното съхранение може да е SQL/NoSQL, но полетата и правилата са стабилни.

### 6.1 User
- `id` (UUID)
- `email`
- `password_hash`
- `display_name`
- `avatar_url` (optional)
- `phone` (optional; видимост по настройка)
- `contact_preference` (`IN_PLATFORM_ONLY` | `SHOW_PHONE_OPTIONAL`)
- `is_email_verified`
- `role` (`USER` | `MODERATOR` | `ADMIN`)
- `created_at`, `updated_at`, `last_login_at`

### 6.2 CatPost (Обява)
- `id` (UUID)
- `type` (`LOST` | `FOUND`)
- `status` (`ACTIVE` | `RESOLVED` | `ARCHIVED` | `HIDDEN_BY_MODERATION`)
- `author_user_id` (FK)
- `title` (например „Изгубена котка в Младост“)
- `description`
- `event_datetime` (кога е изгубена/намерена)
- `event_datetime_precision` (`EXACT` | `APPROXIMATE`)
- `location`
  - `latitude`, `longitude`
  - `location_label` (град/квартал/описание)
  - `accuracy_radius_m` (напр. 500)
- `cat_profile`
  - `name` (optional)
  - `sex` (`MALE` | `FEMALE` | `UNKNOWN`)
  - `age_group` (`KITTEN` | `ADULT` | `SENIOR` | `UNKNOWN`)
  - `size` (`SMALL` | `MEDIUM` | `LARGE` | `UNKNOWN`)
  - `fur_length` (`SHORT` | `MEDIUM` | `LONG` | `UNKNOWN`)
  - `primary_color` (enum + свободен текст fallback)
  - `secondary_color` (optional)
  - `pattern` (`SOLID` | `TABBY` | `TUXEDO` | `CALICO` | `OTHER` | `UNKNOWN`)
  - `distinctive_marks` (optional)
- `chip_number` (optional; нормализиран)
- `passport_number` (optional)
- `is_neutered` (optional)
- `health_notes` (optional)
- `found_care_info` (само за FOUND; optional)
  - `is_sheltered` (bool/unknown)
  - `needs_vet` (bool/unknown)
- `views_count`
- `created_at`, `updated_at`, `resolved_at` (optional)

### 6.3 Photo
- `id` (UUID)
- `post_id` (FK)
- `storage_key` / `url`
- `thumb_url`
- `position` (0..4)
- `width`, `height` (optional)
- `created_at`

### 6.4 MessageThread / Message
- Thread:
  - `id`, `post_id`, `created_by_user_id`, `created_at`, `status` (`OPEN/CLOSED`)
- Message:
  - `id`, `thread_id`, `sender_user_id`, `body`, `created_at`
  - `is_flagged` (bool), `flag_reason` (optional)

### 6.5 Report (Сигнал)
- `id`
- `target_type` (`POST` | `MESSAGE` | `USER`)
- `target_id`
- `reporter_user_id`
- `reason` (enum + free text)
- `status` (`OPEN` | `IN_REVIEW` | `RESOLVED` | `REJECTED`)
- `created_at`, `resolved_at`

### 6.6 MatchSuggestion
- `id`
- `lost_post_id`
- `found_post_id`
- `score` (0..1)
- `reasons` (списък/JSON: distance, time_diff, color_match…)
- `created_at`

### 6.7 AuditLog
- `id`
- `actor_user_id`
- `action` (e.g. HIDE_POST, BAN_USER)
- `target_type`, `target_id`
- `metadata` (JSON)
- `created_at`

---

## 7) API/Интеграционни контракти (технологично неутрални)
### 7.1 Основни ресурси
- `POST /auth/register`
- `POST /auth/login`
- `GET /posts`
- `POST /posts`
- `GET /posts/{id}`
- `PATCH /posts/{id}`
- `POST /posts/{id}/photos`
- `DELETE /photos/{id}`
- `GET /chip/{chip_number}` (търсене по микрочип)
- `POST /posts/{id}/contact` (създава thread)
- `GET /threads`
- `POST /threads/{id}/messages`
- `POST /reports`

### 7.2 Пагинация и филтри
- Стандарт: `page`, `page_size`, `sort`, `filters[...]`.
- Гео-филтър: `lat`, `lng`, `radius_km`.

---

## 8) Политики и правила
### 8.1 Политика за съдържание
- Забрана за публикуване на лични адреси (точен адрес), насилие, измами.
- Контакти (телефон) — само ако потребителят изрично разреши.

### 8.2 Ретенция
- Снимки и обяви в ARCHIVED — да се пазят X месеца (напр. 24), след което да се изтриват/анонимизират (политика).

### 8.3 Сигурност на локацията
- Публично показване: координатите са „snapped“ / замъглени в рамките на accuracy_radius.
- В DB се пазят реалните координати (по избор) или също замъглени — според политика.

---

## 9) Приемателни критерии (Acceptance criteria — примери)
- Потребител може да публикува LOST обява с 1–5 снимки и карта пин.
- Потребител може да публикува FOUND обява със същите полета.
- Гост може да търси и филтрира обяви без регистрация.
- Проверка по микрочип връща коректни активни обяви.
- Контактът става чрез вътрешни съобщения без разкриване на имейл по подразбиране.
- Модератор може да скрие обява и това се записва в audit log.

---

## 10) MVP vs Next
### MVP (минимум)
- Регистрация/вход
- Създаване/листинг/детайл на LOST и FOUND
- Качване на снимки (до 5)
- Локация + филтър по радиус
- Микрочип проверка
- Контакт чрез съобщения
- Основна модерация (report + hide)

### Next (след MVP)
- По-умен matching + известия за нови съвпадения
- Push notifications
- „Verified shelters“ акаунти
- AI помощ за класифициране на котка по снимка (опционално)
- Мултиезичност
